#!/bin/bash

declare -a servers=("james" "gpu0" "gpu1" "gpu2" "gpu3" "gpu6" "gpu8")

function show_usage() {
    echo "Usage: $0 [<who> <users> <uptime> <w> <tmux>]" 1>&2;
    exit 1;
}

command=uptime

while [[ $# -gt 0 ]]; do
    opt="$1"
    shift;
    case "$opt" in
        "who")
            command="who"
            ;;
        "users")
            command="users"
            ;;
        "uptime")
            command="uptime"
            ;;
        "w")
            command="w"
            ;;
        "tmux")
            command="tmux ls"
            ;;
        *)
            show_usage
            exit 0
            ;;
    esac
done

for server in "${servers[@]}"
do
    answer=`ssh ${server} ${command} 2>&1`
    echo "${server} : ${answer}"
done

